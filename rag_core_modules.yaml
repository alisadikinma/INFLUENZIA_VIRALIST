# RAG Core Modules Configuration
# Version: v3.8.0 (patched from user file)
# Purpose: Core content structure and emotional pacing for LLM prompts

version: "3.8.0"
pattern_ref_prefix: "!RAG_CORE_MODULES"
compiled_from:
  - "Hook Template Bank v3.8.0"
  - "Script Format Blueprint v3.8.0"

# ===== DEFAULT TONE =====
default_tone:
  baseline_emotional_state: "curious_engagement_with_cultural_authenticity"
  indonesian_gen_z_markers:
    - "natural_code_switching_indonesian_english"
    - "playful_slang_with_respectful_boundaries"
    - "meme_friendly_phrasing"
  voice_constraints:
    no_preachy: true
    no_too_formal: true
    no_excessive_emoji: true
  tone_transitions:
    - from: "curious"
      to: "surprised"
      trigger: "fact_reveal"
    - from: "surprised"
      to: "clarified"
      trigger: "explain_clearly"

# ===== HOOK PATTERN BANK =====
hook_patterns:
  myth_bust:
    template: "Bukan [assumption], tapi [reality]"
    guardrails:
      - "no_unverified_claims"
  counter_intuitive:
    template: "Semakin [X], malah [Y]"
  what_if:
    template: "Gimana kalau [scenario]?"
  stat_shock:
    template: "[credible_number]% dari [group] [finding]"
    requires_citation: true

# ===== VIRAL HOOK ENGINE =====
viral_hook_engine:
  module_id: "viral_hook_engine"
  enabled: true
  psychological_triggers:
    cognitive_dissonance:
      - pattern: "Dulu gue [belief], ternyata [opposite_reality]"
        activation: "when topic involves mindset/belief change"
    authority_questioning:
      - pattern: "Yang [authority_figure] gak mau kalian tau tentang [topic]"
        activation: "when topic involves industry/institutional critique"
    social_proof_challenge:
      - pattern: "Everyone's doing [trend] wrong, ini cara yang bener"
        activation: "when topic involves popular practices"
    group_identity_threat:
      - pattern: "Gen Z yang masih [assumption] perlu denger ini"
        activation: "when topic involves generational commentary"
  hook_archetype_pool:
    personal_contradiction: 0.25
    exposed_secret: 0.25
    generational_callout: 0.25
    cultural_inversion: 0.25

# ===== FALLBACK CHAIN =====
fallback_chain:
  module_id: "fallback_chain"
  enabled: true
  primary_fallbacks:
    style_fusion_failure:
      condition: "fusion_feels_unnatural_or_forced"
      action: "revert_to_single_creator_style"
    overlong_block:
      condition: "block_duration_seconds > 5"
      action: "auto_split_into_≤5s"
  secondary_fallbacks:
    missing_citation:
      condition: "claim_requires_citation && citation_missing"
      action: "downgrade_claim_to_soft_language"

# ===== EMOTIONAL VALLEY =====
emotional_valley:
  module_id: "emotional_valley"
  enabled: true
  description: "Bridge HOOK→PEAK→BODY→CTA dengan 'valley' terkontrol untuk retensi"
  external_profile_ref: "emotional_glide.yaml#glide_profiles.valley"
  parameters:
    valley_depth: "medium"
    recovery_speed: "fast"

# ===== TWIST GENERATION ENGINE =====
twist_generation_engine:
  module_id: "twist_generation_engine"
  enabled: true
  patterns:
    - name: "expectation_subversion"
      trigger: "conflict or realization"
      twist: "reversed emotional payoff"
  validator:
    enforce_surprise: true
    enforce_contrast_with_body: true

# Ensure no legacy fact_check_filter; use runtime_safeguard.enhanced_fact_verification only
fact_check_filter:
  enabled: false

# Keep visual sync optimizer mapping
visual_sync_mapper:
  enabled: true

# ✅ PATCHED MODULE — EDU MODE ENGINE
edu_mode_engine:
  triggers:
    - topic: ["AI", "sains", "sistem kerja", "teknologi masa depan"]
      tone: "reflektif"
  behavior:
    - prioritize_fact_check: true
    - simplify_language: true
    - emphasize_learning: true

# ✅ PATCHED MODULE — EDUCATIONAL FACT INSERTER
educational_fact_inserter:
  module_id: "educational_fact_inserter"
  enabled: false
  trigger_fields: ["script"]
  conditions:
    topic_match: ["biocomputing", "AI hardware", "neuromorphic"]
  insert_type: "inline_number"
  data_source: ["wiki.techfacts", "cortical_labs.pub", "pubmed.live"]
  fallback: "use_fact_template"

# ===== KLING ADAPTATION LOGIC =====
kling_adaptation_logic:
  module_id: "kling_adaptation"
  enabled: true
  enable_causal_chain: true
  causal_graph_template:
    - id: A
      event: "Character discovers clue"
    - id: B
      event: "Ally reveals new constraint"
    - id: C
      event: "Antagonist raises the stakes"
    - id: D
      event: "Resolution with twist"
  controversy_injection:
    industry_secrets:
      patterns:
        - "Cuma 10% orang yang actually paham ini"
        - "Most people don't know this industry secret"
        - "Info ini jarang banget dishare publicly"
      activation_trigger: "when educational_content = true"
    time_sensitivity:
      patterns:
        - "Before trend ini dead, kalian harus tau"
        - "Sebelum terlambat, ini yang perlu kalian prepare"
        - "Window opportunity ini cuma sebentar"
      activation_trigger: "when trend_related = true"

# ===== FOMO & CONTROVERSY ENGINE =====
fomo_controversy_engine:
  module_id: "fomo_controversy_engine"
  enabled: true
  debate_starters:
    - "Kubu A bilang [X], kubu B bilang [Y] — mana yang bener?"
    - "Kalau kalian di posisi [role], milih [option1] atau [option2]?"
  guardrails:
    - "no_personal_attack"
    - "avoid_false_dichotomy"
    - "cite_before_spice"

# ===== DEEP RESEARCH ENGINE (PATCHED STRUCTURE) =====
deep_research_engine:
  module_id: "comprehensive_research_pipeline"
  enabled: true
  activation_trigger: "post_fact_verification_success"
  priority: "CRITICAL_CONTENT_ENRICHMENT"

  inputs:
    required: ["topic", "draft_script", "locale"]

  research_depth_auto_selection:
    basic_research:
      trigger_conditions:
        - simple_topics_with_clear_context
        - well_established_facts
        - non_controversial_subjects
      sources_target: "3_to_5_sources"
    comprehensive_research:
      trigger_conditions:
        - complex_technical_topics
        - trending_controversial_issues
        - health_medical_information
        - financial_economic_topics
      sources_target: "8_to_12_sources"
    expert_level_research:
      trigger_conditions:
        - breaking_news_developments
        - scientific_research_topics
        - legal_regulatory_matters
        - policy_government_issues
      sources_target: "15_plus_sources"

  source_scoring:
    weights:
      author_reputation: 0.35
      domain_authority: 0.25
      recency: 0.25
      cross_corroboration: 0.15
    domain_priority: ["primary_sources", "peer_reviewed", "standards_bodies", "gov", "reputable_media", "aggregators"]
    banned_sources: ["random_forums", "uncited_tweets"]
    recency_windows_days:
      default: 365
      ai: 180
      finance: 90
      health: 730

  retrieval_policy:
    max_sources: 12
    dedupe_by: "canonical_url_hash"
    language_bias: ["id", "en"]

  contradiction_detection:
    enabled: true
    strategies: ["multi_source_crosscheck", "claim_vote", "minority_report"]
    resolution_order: ["primary_sources", "peer_reviewed", "official_statement", "consensus_media"]

  citation_policy:
    min_citations: 3
    include_urls: true
    format: "author_or_org, title, year"
    normalizer_fields: ["source", "title", "url", "date", "type"]

  outputs_contract:
    keys: ["research_summary", "citations", "confidence_score", "claim_register"]

  claim_register:
    schema:
      id: "string"
      text: "string"
      type: "fact|opinion|prediction"
      status: "verified|refuted|uncertain"
      evidence_ids: "list"
      confidence: "0..1"

  handoff:
    to_hook_generator: "research_insights_inform_viral_hook_creation"
    to_narrative_consistency_enforcer: "numbers_and_entities_locked"
    to_style_fusion: "domain_persona_bias_adjusted_by_research_depth"

  metrics:
    hallucination_risk_score: "0..1"

  invariants:
    - "citation_policy.min_citations >= 3"
    - "0.0 <= confidence_score <= 1.0"

research_engine_integration:
  handoff_protocols:
    from_fact_verification: "verified_content_becomes_research_foundation"
    to_hook_generator: "research_insights_inform_viral_hook_creation"
    to_style_fusion: "research_depth_influences_creator_selection"
    to_script_structure: "research_synthesis_shapes_content_organization"
  performance_optimization:
    research_caching: "store_research_results_for_similar_topics"
    source_prioritization: "rank_sources_by_reliability_and_viral_potential"
    insight_extraction: "automated_viral_angle_identification"
    cultural_adaptation: "automatic_indonesian_context_integration"

validation_tags:
  - "deep_research_engine_active"
  - "multi_source_research_complete"
  - "indonesian_context_integrated"
  - "viral_angles_identified"
  - "educational_value_confirmed"

# ===== MODULE REGISTRY =====
modules:
  - name: hook_generator
    function: "Generates culturally grounded hook lines"
    depends_on: []
  - name: emotional_pacer
    function: "Modulates emotional pacing across segments"
    depends_on: [hook_generator]
  - name: style_imprinter
    function: "Applies creator style DNA to script"
    depends_on: [hook_generator]
  - name: tone_shifter
    function: "Adjusts tone transitions per segment"
    depends_on: [emotional_pacer, style_imprinter]
  - name: visual_sync_mapper
    function: "Aligns script segments to visual beat timing"
    depends_on: [tone_shifter]
  - name: emotional_glide_engine
    function: "Controls micro-emotional transitions within segments"
    depends_on: [emotional_pacer, tone_shifter]
  - name: validator_interface
    function: "Ensures output meets all QA, safety, and engagement standards"
    depends_on: [hook_generator, style_imprinter, emotional_pacer, tone_shifter]
  - name: fallback_tone_handler
    function: "Fallback engine when tone/style mismatch detected"
    depends_on: [validator_interface]
  - name: twist_optimizer
    function: "Ensures narrative twists follow emotional & logical arc"
    depends_on: [emotional_pacer, tone_shifter]
  - name: thumbnail_emotion_checker
    function: "Verifies thumbnail tone alignment to script content"
    depends_on: [hook_generator, emotional_glide_engine]
  - name: edu_mode_engine
    function: "Adjusts content style to reflective educational tone when triggered"
    depends_on: [hook_generator, style_imprinter]
  - name: narrative_consistency_enforcer
    function: "Ensures logical coherence and segment consistency across script"
    depends_on: [hook_generator, tone_shifter, style_imprinter]
  - name: deep_research_engine
    function: "Comprehensive multi-source research for informative viral content"
    depends_on: []
    priority: "critical_content_enrichment"

# Tambahkan di bawah ini
module_index:
  hook_generator: "*modules[name=hook_generator]"
  visual_sync_mapper: "*modules[name=visual_sync_mapper]"
  narrative_consistency_enforcer: "*modules[name=narrative_consistency_enforcer]"
  edu_mode_engine: "*modules[name=edu_mode_engine]"
  emotional_valley: "*modules[name=emotional_valley]"
  viral_hook_engine: "*modules[name=viral_hook_engine]"
  fomo_controversy_engine: "*modules[name=fomo_controversy_engine]"
  deep_research_engine: "*modules[name=deep_research_engine]"

# ===== STYLE FUSION SETTINGS =====
style_fusion:
  primary_style: "samuel"
  secondary_style: "jovial"
  tertiary_style: "gadgetin"
  fusion_mode: "weighted_blend"
  dynamic_weighting_enabled: true

# ===== LOOKUP HELPERS =====
hook_bank_lookup:
  module_id: "hook_bank_lookup"
  enabled: true
  source: "!HOOK_BANK/PATTERNS"
  return: "top_k_patterns"
  k: 5

persona_style_guide:
  module_id: "persona_style_guide"
  enabled: true
  source: "!STYLE_ENGINE/STYLE_WEIGHTS"
  return: "persona_bias_map"

trending_meme_snippet:
  module_id: "trending_meme_snippet"
  enabled: true
  source: "!RAG_ENGAGEMENT/MEME_TRIGGER"
  return: "latest_meme_format"
  recency_days: 30